<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>coldout — photo archive</title>
  <style>
    html { scroll-behavior: smooth; }
    body { background-color: #000; overflow-x: hidden; }
    section { scroll-margin-top: 100px; }
    
    .reveal {
      opacity: 0;
      transform: translateY(50px);
      transition: all 1.2s cubic-bezier(0.2, 1, 0.3, 1);
      will-change: transform, opacity;
    }
    .reveal.active { opacity: 1; transform: translateY(0); }

    .masonry-grid { column-count: 2; column-gap: 0.75rem; }
    @media (min-width: 768px) { .masonry-grid { column-count: 3; } }
    @media (min-width: 1024px) { .masonry-grid { column-count: 4; } }
    .masonry-item { break-inside: avoid; margin-bottom: 0.75rem; background: #0a0a0a; }

    #lightbox {
      display: none; position: fixed; inset: 0; z-index: 200;
      background: rgba(0,0,0,0.9); backdrop-filter: blur(20px);
      cursor: zoom-out; opacity: 0; transition: opacity 0.4s ease;
      align-items: center; justify-content: center;
    }
    #lightbox.active { display: flex; opacity: 1; }
    #lightbox img { max-width: 90%; max-height: 90%; object-fit: contain; transform: scale(0.98); transition: transform 0.5s cubic-bezier(0.2, 1, 0.3, 1); }
    #lightbox.active img { transform: scale(1); }

    #back-to-top { opacity: 0; visibility: hidden; transition: all 0.4s ease; }
    #back-to-top.visible { opacity: 1; visibility: visible; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: #000; }
    ::-webkit-scrollbar-thumb { background: #18181b; }
  </style>
</head>
<body class="text-zinc-400 font-sans selection:bg-zinc-800">

  <nav class="fixed top-0 left-0 w-full px-6 py-4 md:px-10 flex flex-row justify-between items-center z-50 bg-black/60 backdrop-blur-md border-b border-white/5">
    <div class="text-white tracking-[0.2em] lowercase font-light text-sm md:text-base cursor-pointer" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">coldout</div>
    <div id="nav-years" class="flex items-center space-x-4 md:space-x-6 text-[10px] tracking-[0.1em] lowercase font-light overflow-x-auto"></div>
  </nav>

  <div id="lightbox" onclick="closeLightbox()">
    <img id="lightbox-img" src="" alt="">
  </div>

  <div id="gallery-overlay" class="hidden fixed inset-0 bg-black z-[100] overflow-y-auto p-6 md:p-20">
    <div class="flex justify-between items-baseline mb-16 max-w-[1600px] mx-auto">
      <h2 id="gallery-title" class="text-white text-3xl font-thin lowercase tracking-tighter"></h2>
      <button onclick="closeGallery()" class="text-zinc-600 hover:text-white uppercase text-[9px] tracking-[0.3em] transition-colors border-b border-zinc-800 hover:border-white pb-1">close</button>
    </div>
    <div id="gallery-grid" class="masonry-grid max-w-[1600px] mx-auto pb-20"></div>
    <button id="back-to-top" onclick="galleryScrollTop()" class="fixed bottom-10 right-10 w-16 h-16 rounded-full border border-white/10 bg-black/50 backdrop-blur-md flex items-center justify-center text-white hover:border-white/40 transition-all z-[110]">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M18 15l-6-6-6 6"/></svg>
    </button>
  </div>

  <main id="main-content" class="pt-24 px-6 md:px-20 max-w-[1600px] mx-auto">
    <div id="years-container"></div>
  </main>

  <footer class="p-20 text-center border-t border-zinc-950">
    <div class="text-[9px] lowercase tracking-[0.5em] text-zinc-800">coldout &copy; 2026</div>
  </footer>

  <script>
    // ИЗМЕНЕНО НА web
    const GITHUB_USER = "coldoutt";
    const GITHUB_REPO = "web";
    const BRANCH = "main";
    const RAW_BASE = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${BRANCH}/photo`;

    async function initSite() {
      const container = document.getElementById('years-container');
      try {
        const response = await fetch(`data.json?v=${new Date().getTime()}`);
        if (!response.ok) throw new Error(`data.json not found`);
        
        const data = await response.json();
        const navContainer = document.getElementById('nav-years');
        const years = Object.keys(data).sort((a, b) => b - a);

        years.forEach(year => {
          const navLink = document.createElement('a');
          navLink.href = `#year-${year}`;
          navLink.className = "hover:text-white transition-colors";
          navLink.innerText = year;
          navContainer.appendChild(navLink);

          const section = document.createElement('section');
          section.id = `year-${year}`;
          section.className = 'mb-24 reveal';
          
          const tripsHtml = data[year].map(trip => {
            const randomIdx = Math.floor(Math.random() * trip.count) + 1;
            const coverUrl = `${RAW_BASE}/${year}/${trip.folder}/${randomIdx}.jpg`;
            
            return `
              <div onclick="openGallery('${trip.title}', '${year}/${trip.folder}', ${trip.count})" class="group cursor-pointer">
                <div class="aspect-[4/5] bg-zinc-900 overflow-hidden mb-1 relative block">
                  <img src="${coverUrl}" 
                       onerror="this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center text-[8px] tracking-widest opacity-20\'>IMAGE NOT FOUND</div>'"
                       class="object-cover w-full h-full grayscale group-hover:grayscale-0 transition-all duration-1000">
                </div>
                <h3 class="text-white text-3xl font-thin lowercase tracking-tighter opacity-60 group-hover:opacity-100 transition-opacity duration-500 leading-tight">${trip.title}</h3>
              </div>
            `;
          }).join('');

          section.innerHTML = `
            <div class="border-b border-zinc-900 pb-2 mb-10">
              <h2 class="text-5xl md:text-6xl font-extralight text-white tracking-tighter">${year}</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
              ${tripsHtml}
            </div>
          `;
          container.appendChild(section);
        });

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('active');
          });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

      } catch (e) { 
        console.error("Archive Error:", e);
        container.innerHTML = `<div class="text-center py-40 text-red-900 text-[10px] uppercase tracking-[0.4em]">Error: ${e.message}</div>`;
      }
    }

    function openGallery(title, path, count) {
      const grid = document.getElementById('gallery-grid');
      document.getElementById('gallery-title').innerText = title;
      grid.innerHTML = '';
      document.getElementById('gallery-overlay').classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      for (let i = 1; i <= count; i++) {
        const item = document.createElement('div');
        item.className = 'masonry-item overflow-hidden';
        const imgUrl = `${RAW_BASE}/${path}/${i}.jpg`;
        const img = document.createElement('img');
        img.src = imgUrl;
        img.className = 'w-full h-auto opacity-0 transition-all duration-1000 cursor-zoom-in block';
        img.onload = function() {
          this.classList.replace('opacity-0', 'opacity-60');
          this.classList.add('hover:opacity-100');
        };
        img.onclick = () => openLightbox(imgUrl);
        item.appendChild(img);
        grid.appendChild(item);
      }
    }

    const galleryOverlay = document.getElementById('gallery-overlay');
    function closeGallery() { galleryOverlay.classList.add('hidden'); document.body.style.overflow = 'auto'; }
    function openLightbox(src) { document.getElementById('lightbox-img').src = src; document.getElementById('lightbox').classList.add('active'); }
    function closeLightbox() { document.getElementById('lightbox').classList.remove('active'); }
    function galleryScrollTop() { galleryOverlay.scrollTo({ top: 0, behavior: 'smooth' }); }
    
    galleryOverlay.addEventListener('scroll', () => {
      document.getElementById('back-to-top').classList.toggle('visible', galleryOverlay.scrollTop > 800);
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (document.getElementById('lightbox').classList.contains('active')) closeLightbox();
        else if (!galleryOverlay.classList.contains('hidden')) closeGallery();
      }
    });

    initSite();
  </script>
</body>
</html>
